<html>
  <body>
    <script>
     const jsonp = (url, callback) => {
       const callbackName = `callback${Math.random().toString().replace(".", "")}`;
       const scriptEl = document.createElement("script");
       window[callbackName] = (...args) => {
         document.body.removeChild(scriptEl);
         return callback(...args);
       }
       scriptEl.setAttribute("src", `${url}${url.indexOf("?") > -1 ? "&" : "?"}callback=${callbackName}`);
       document.body.appendChild(scriptEl);
     };

     const apiUrl = "https://api.phish.net/api.js";
     const pnet = ({method}) => `${apiUrl}?method=${method}`;

     const el = (tagName, ...children) => {
       const element = document.createElement(tagName);
       if (children) {
         console.log("children", children);
         if (children.length === 1) {
           element.appendChild(children[0]);
         } else {
           children.map(element.appendChild.bind(element));
         }
       }
       return element;
     };
     const text = (content) => {
       return document.createTextNode(content);
     };

     jsonp(
       pnet({method: "pnet.shows.setlists.tiph"}),
       (data) => {
         const {nicedate, venue, city, state, setlistnotes} = data[0];
         const sanitizedNotes = setlistnotes.replace(/&#39;/g, "'").replace(/&nbsp;/g, " ");
         document.body.appendChild(
           el("div",
             el("h1", text("Today in Phish History!")),
               el("p", text(`${nicedate} at ${venue} in ${city}, ${state}: ${sanitizedNotes}`))
           )
         );
       }
     );
    </script>
  </body>
</html>
